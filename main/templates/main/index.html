{% extends 'main/base.html' %}
{% load static %}
{% block index %}

        <!-- Work -->
        <div class="promo-block">
            <img class="img-responsive" src="{% static 'images/slider.png' %}" align="Avatar">
            </div>
        </div>
{%endblock %}


                    <!-- Work -->
{% block content %}




                <div class="row margin-b-40">
                    <div class="col-sm-6">
                        <h2></h2>
                        </div>
                </div>

                <div class="row margin-b-40">
                    <div class="col-sm-6">
                        <h2>Новости</h2>
                        </div>
                </div>
                <!--// end row -->


                {% for news in post %}
                <div class="row-3">
                    <!-- Latest Products -->
                    <div class="col-sm-4 sm-margin-b-50">
                        <div class="margin-b-20">
                            <div class="wow zoomIn" data-wow-duration=".3" data-wow-delay=".1s">
                                {% if news.image %}
                                <img class="img-responsive" src="{{ news.image.url }}" alt="Latest Products Image" width="300" height="100">
                                    {% else %}
                                <img src="#" alt="" width="400">
                                {% endif %}
                            </div>
                        </div>
                        <h4><a href="/post/{{ news.id }}/" >{{news.title}}</a> <span class="text-uppercase margin-l-20">{{news.category_id}}</span></h4>
                        <p class="card-text">{{news.text}}</p>
                        <p class="card-text" style="color:#000000">{{ news.content|safe|linebreaks|truncatewords:10 }}</p>
                        <p class="card-text">{{ news.created_date }}</p>
                            <span class="text-uppercase margin-l-20">{{ news.user }}</span>
                        <div class="col-md-8 mt-4 mb-4">
                              <p>  {{news.total_views}}  Views</p>
                              <p>  {{news.total_likes}}  likes</p>
<!--                        <p class="card-text">{{ news.views }}</p>-->



                        <!----------TAGS---------->

                            <p class="tags">
                            Tags:
                            {% for tag in news.tags.all %}
                                <a href="{% url 'post_list_by_tag' tag.slug %}">
                                    {{ tag.name }}
                                </a>
                                {% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                        {% for tag in tags %}
                                <a href="{% url 'posts_by_tag' tag.slug %}">{{tag.name}}</a>
                              {% endfor %}
                           <div class="container">
                              {% for tag in tag %}
                                <a href="{% url 'posts_by_tag' tag.slug %}">{{tag.name}}</a>
                              {% endfor %}
                              {% for post in posts %}
                                <div class="col-md-8 mt-4 mb-4">
                                  <h3>{{post.title}}</h3>
                                  <p>{{post.created_at}}</p>
                                  <p>  {{post.total_views}}  Views</p>
                                  <p>  {{post.total_likes}}  likes</p>
                                  {% for tag in post.tags.all %}
                                    <a href="{% url 'posts_by_tag' tag.slug %}">{{tag.name}}</a>
                                  {% endfor %}
                                  <a href="{% url 'post_detail' pk=post.id %}" class="btn btn-sm btn-primary">Read More</a>
                                </div>
                              {% endfor %}
                            </div>

                        <!----------END TAGS---------->


                        {% if user.is_authenticated %}
                            <a class="link" href="/post_edit/{{ news.id }}/edit">Редактировать</a>
                            <a class="link" href="/post_delete/{{ news.id }}/">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Удалить</a>
                        {% endif %}
                        <!----------LIKE---------->
                            <ul>
                                <li data-id="{{ like_obj.id }}" data-type="article" data-action="like" title="Нравится">
                                    <span class="glyphicon glyphicon-thumbs-up"></span>
                                    <span data-count="like">{{ like_obj.votes.likes.count }}</span>
                                </li>
                                <li data-id="{{ like_obj.id }}" data-type="article" data-action="dislike" title="Не нравится">
                                    <span class="glyphicon glyphicon-thumbs-down"></span>
                                    <span data-count="dislike">{{ like_obj.votes.dislikes.count }}</span>
                                </li>
                            </ul>
                        <script>
                            function like()
{
    var like = $(this);
    var type = like.data('type');
    var pk = like.data('id');
    var action = like.data('action');
    var dislike = like.next();

    $.ajax({
        url : "/api/" + type +"/" + pk + "/" + action + "/",
        type : 'POST',
        data : { 'obj' : pk },

        success : function (json) {
            like.find("[data-count='like']").text(json.like_count);
            dislike.find("[data-count='dislike']").text(json.dislike_count);
        }
    });

    return false;
}

function dislike()
{
    var dislike = $(this);
    var type = dislike.data('type');
    var pk = dislike.data('id');
    var action = dislike.data('action');
    var like = dislike.prev();

    $.ajax({
        url : "/api/" + type +"/" + pk + "/" + action + "/",
        type : 'POST',
        data : { 'obj' : pk },

        success : function (json) {
            dislike.find("[data-count='dislike']").text(json.dislike_count);
            like.find("[data-count='like']").text(json.like_count);
        }
    });

    return false;
}

// Connecting Handlers
$(function() {
    $('[data-action="like"]').click(like);
    $('[data-action="dislike"]').click(dislike);
});
                        </script>

                          <!----------END LIKE---------->
                    </div>
                    <!-- End Latest Products -->
                </div>

                </div>
            {% endfor %}


        </div>


<script type="text/javascript" src="{% static 'js/ikedislike.js' %}"></script>


<!--         End Work -->
{% endblock %}